<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1" name="viewport"/>
    <title>Tens City - Static Blog</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
            line-height: 1.6;
            color: #24292e;
            background: #f5f5f5;
        }
        
        header {
            background: #fff;
            border-bottom: 1px solid #e1e4e8;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            padding: 1.5rem 2rem;
        }
        
        header h1 {
            font-size: 1.75rem;
            font-weight: bold;
            color: #24292e;
        }
        
        header p {
            color: #586069;
            margin-top: 0.5rem;
        }
        
        main {
            max-width: 800px;
            margin: 2rem auto;
            padding: 0 1rem;
        }
        
        .post-list {
            background: #fff;
            border-radius: 6px;
            border: 1px solid #e1e4e8;
            overflow: hidden;
        }
        
        .post-item {
            padding: 1.5rem;
            border-bottom: 1px solid #e1e4e8;
            transition: background 0.2s;
        }
        
        .post-item:last-child {
            border-bottom: none;
        }
        
        .post-item:hover {
            background: #f6f8fa;
        }
        
        .post-item h2 {
            font-size: 1.25rem;
            margin-bottom: 0.5rem;
        }
        
        .post-item h2 a {
            color: #0366d6;
            text-decoration: none;
        }
        
        .post-item h2 a:hover {
            text-decoration: underline;
        }
        
        .post-item .meta {
            color: #586069;
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
        }
        
        .post-item .description {
            color: #586069;
            line-height: 1.5;
        }
        
        .loading {
            text-align: center;
            padding: 2rem;
            color: #586069;
        }
        
        .error {
            text-align: center;
            padding: 2rem;
            color: #d73a49;
        }
        
        footer {
            text-align: center;
            padding: 2rem;
            color: #586069;
            font-size: 0.875rem;
        }
        
        footer a {
            color: #0366d6;
            text-decoration: none;
        }
        
        footer a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <header>
        <h1>üèïÔ∏è Tens City</h1>
        <p>A static blog hosting system with content-addressable storage</p>
    </header>
    
    <main>
        <div id="posts" class="loading">Loading posts...</div>
    </main>
    
    <footer>
        <p>
            Powered by <a href="https://github.com/stackdump/tens-city" target="_blank">tens-city</a>
        </p>
    </footer>
    
    <script>
        // Load and display blog posts
        async function loadPosts() {
            const postsEl = document.getElementById('posts');
            
            try {
                const response = await fetch('/posts/index.jsonld');
                if (!response.ok) {
                    throw new Error('Failed to load posts');
                }
                
                const index = await response.json();
                const items = index.itemListElement || [];
                
                if (items.length === 0) {
                    postsEl.innerHTML = '<div class="error">No posts found</div>';
                    return;
                }
                
                // Redirect to the latest post immediately
                const latestItem = items[0];
                const post = latestItem.item || latestItem;
                const url = post.url || post['@id'];
                
                if (url) {
                    // Extract slug from URL
                    const parts = url.split('/posts/');
                    if (parts.length > 1) {
                        const slug = parts[1].split(/[?#]/)[0];
                        if (slug) {
                            window.location.href = `/posts/${slug}`;
                            return;
                        }
                    }
                }
                
                // Fallback: show list if redirect fails
                renderPostList(items);
                
            } catch (err) {
                console.error('Failed to load posts:', err);
                postsEl.innerHTML = '<div class="error">Failed to load posts</div>';
            }
        }
        
        function renderPostList(items) {
            const postsEl = document.getElementById('posts');
            postsEl.className = 'post-list';
            postsEl.innerHTML = '';
            
            items.forEach(item => {
                const post = item.item || item;
                const url = post.url || post['@id'];
                
                const postDiv = document.createElement('div');
                postDiv.className = 'post-item';
                
                const title = document.createElement('h2');
                const link = document.createElement('a');
                if (url) {
                    const parts = url.split('/posts/');
                    if (parts.length > 1) {
                        const slug = parts[1].split(/[?#]/)[0];
                        link.href = `/posts/${slug}`;
                    }
                }
                link.textContent = post.headline || post.name || post.title || 'Untitled';
                title.appendChild(link);
                postDiv.appendChild(title);
                
                if (post.datePublished) {
                    const meta = document.createElement('div');
                    meta.className = 'meta';
                    const date = new Date(post.datePublished);
                    meta.textContent = `üìÖ ${date.toLocaleDateString()}`;
                    postDiv.appendChild(meta);
                }
                
                if (post.description) {
                    const desc = document.createElement('div');
                    desc.className = 'description';
                    desc.textContent = post.description;
                    postDiv.appendChild(desc);
                }
                
                postsEl.appendChild(postDiv);
            });
        }
        
        // Load posts on page load
        loadPosts();
    </script>
</body>
</html>
