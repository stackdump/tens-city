<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <title>Anchor Permalink Test</title>
    <style>
        body {
            font-family: system-ui, sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        .status { 
            padding: 10px; 
            margin: 10px 0; 
            border-radius: 4px; 
        }
        .pass { background: #d4edda; color: #155724; }
        .fail { background: #f8d7da; color: #721c24; }
        pre {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            word-wrap: break-word;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>Permalink Anchor Test</h1>
    
    <div id="test-container">
        <h2>Test Results</h2>
        <div id="results"></div>
    </div>

    <script type="module">
        import { TensCity } from './tens-city.js';

        const results = document.getElementById('results');
        
        function addResult(name, passed, details) {
            const div = document.createElement('div');
            div.className = 'status ' + (passed ? 'pass' : 'fail');
            div.innerHTML = `<strong>${passed ? '✓' : '✗'} ${name}</strong>`;
            if (details) {
                const pre = document.createElement('pre');
                pre.textContent = details;
                div.appendChild(pre);
            }
            results.appendChild(div);
        }

        // Test 1: Component definition
        try {
            const componentDefined = customElements.get('tens-city') !== undefined;
            addResult('TensCity Component Defined', componentDefined, 
                componentDefined ? 'Component is registered' : 'Component not found');
        } catch (err) {
            addResult('TensCity Component Defined', false, err.message);
        }

        // Test 2: Create component instance
        let component;
        try {
            component = document.createElement('tens-city');
            const isInstance = component instanceof TensCity;
            addResult('Component Instance Creation', isInstance, 
                isInstance ? 'Component instance created successfully' : 'Not a TensCity instance');
        } catch (err) {
            addResult('Component Instance Creation', false, err.message);
        }

        // Test 3: Check permalink anchor exists after initialization
        setTimeout(() => {
            try {
                // The component needs to be in the DOM and authenticated to show the app
                // We'll just test the basic structure
                const hasPermalinkProp = '_permalinkAnchor' in component;
                addResult('Permalink Anchor Property', hasPermalinkProp, 
                    hasPermalinkProp ? 'Component has _permalinkAnchor property' : 'Property not found');
            } catch (err) {
                addResult('Permalink Anchor Property', false, err.message);
            }

            // Test 4: Check _updatePermalinkAnchor method exists
            try {
                const hasMethod = typeof component._updatePermalinkAnchor === 'function';
                addResult('Update Permalink Method', hasMethod, 
                    hasMethod ? '_updatePermalinkAnchor method exists' : 'Method not found');
            } catch (err) {
                addResult('Update Permalink Method', false, err.message);
            }

            // Summary
            const passedCount = document.querySelectorAll('.pass').length;
            const totalTests = document.querySelectorAll('.status').length;
            const allPassed = passedCount === totalTests;
            const summary = document.createElement('div');
            summary.className = 'status ' + (allPassed ? 'pass' : 'fail');
            summary.innerHTML = `<strong>Summary: ${passedCount}/${totalTests} tests passed</strong>`;
            results.appendChild(summary);
        }, 100);
    </script>
</body>
</html>
